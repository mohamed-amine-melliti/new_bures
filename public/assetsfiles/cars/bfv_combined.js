window.analytics_ow.personalisation.templatecodes.bfvCombined=new analytics_ow.personalisation.template({tracking_object:{type:"alwayson_experience-targeting_manual",campaign:"best-fitting-vehicle",format:"simple-teaser",experience:"target",vehicle:"",trigger:""},target:async function(e,a,t,n,i){analytics_ow.personalisation.func.setLocales();const s=window.analytics_ow.personalisation.func.find_all_by_key(dataLayer_ow,"name")[0];if(t.vehicle_type="vans"==s&null!=e.highest_affinity.van?"van":"passengercars"==s&null!=e.highest_affinity.car?"car":null,e.segments&&e.highest_affinity&&(t.segments=e.segments[t?.vehicle_type],t.highest_affinity=e.highest_affinity[t?.vehicle_type]),i({"vars.highest_affinity":{exp:"string",val:typeof t.highest_affinity},"vars.segments.testdrive_started":{exp:!1,val:t.segments?.testdrive_started}}),t.highest_affinity&&!t.segments.testdrive_started){const s=await analytics_ow.personalisation.func.getVehicleDeeplinks();i({vehicle_data_available:{exp:!0,val:s}}),s&&a.set_values(e,a,t,n,i)}},control:async function(e,a,t,n){},experience_specific_methods:{set_values:async function(e,a,t,n,i){const s=JSON.parse(sessionStorage["target_vehicle_deeplinks_"+t.language]);let l,c;if(vehicle_modelcode="van"==t.vehicle_type?t.highest_affinity:await analytics_ow.personalisation.func.getVMDSData_modelmapping(t.highest_affinity)||await analytics_ow.personalisation.func.getVMDSData_modelmapping(t.highest_affinity.replace("4653","4652")),l="van"==t.vehicle_type?await analytics_ow.personalisation.func.getVMDSData_modelspecific(vehicle_modelcode)||await analytics_ow.personalisation.func.getVMDSData_modelspecific(`${vehicle_modelcode}-fl`):await analytics_ow.personalisation.func.getVMDSData_modelspecific(vehicle_modelcode),t.mvp=("TR"===t.market||"DE"===t.market)&&e.onlineShop_label,n.experience=e.target_group,e?.vehicles_overwrite&&(c=e.vehicles_overwrite.find((e=>e.baumuster===t.highest_affinity))),i([{block_phase1:{exp:void 0,val:c?.block_phase1},block_phase2:{exp:void 0,val:c?.block_phase2},block_phase3:{exp:void 0,val:c?.block_phase3}}]),i([{activate_phase1:{exp:!0,val:e.activate_phase1},activate_phase2:{exp:!0,val:e.activate_phase2},activate_phase3:{exp:!0,val:e.activate_phase3}}]),i([{config_started:{exp:!0,val:t.segments?.config_started},config_completed:{exp:!0,val:t.segments?.config_completed}}]),i([{vehicle_type_car:{exp:"car",val:t.vehicle_type},vehicle_type_van:{exp:"van",val:t.vehicle_type},activate_vans:{exp:!0,val:e.activate_vans},activate_cars:{exp:!0,val:e.activate_cars}}]),document.location.search.includes("test=p3")||e.activate_phase3&&t.segments.config_completed&&!t.segments.testdrive_started&&!c?.block_phase3&&("van"!=t.vehicle_type||e.activate_vans)&&("car"!=t.vehicle_type||e.activate_cars)?n.trigger="phase3":document.location.search.includes("test=p2")||e.activate_phase2&&t.segments.config_started&&!t.segments.config_completed&&!t.segments.testdrive_started&&!c?.block_phase2&&("van"!=t.vehicle_type||e.activate_vans)&&("car"!=t.vehicle_type||e.activate_cars)?n.trigger="phase2":!document.location.search.includes("test=p1")&&(!e.activate_phase1||t.segments.config_started||t.segments.config_completed||t.segments.testdrive_started||c?.block_phase1||"van"==t.vehicle_type&&!e.activate_vans||"car"==t.vehicle_type&&!e.activate_cars)||(n.trigger="phase1"),i({"tracking_object.trigger_exists":{exp:!0,val:""!==n.trigger}}),""!==n.trigger){const c=s[l.modelSeries],o=c?.PRODUCT_PAGE?.modelSeriesUrl,p=c?.TEST_DRIVE?.modelSeriesUrl,_=c?.ONLINE_SHOP?.modelSeriesUrl,m=c?.CONFIGURATOR?.modelSeriesUrl;switch(n.vehicle=l.modelSeries.toLowerCase(),t.mvp=t.mvp&&"string"==typeof _&&"phase1"===n.trigger,t.copy=e[`${n.trigger}_copy`],t.primaryBtn_label=t.mvp?e.onlineShop_label:e[`${n.trigger}_primaryBtn`],t.secondaryBtn_label=t.mvp?e[`${n.trigger}_primaryBtn`]:e[`${n.trigger}_secondaryBtn`],t.headline=l.name,n.trigger){case"phase1":t.primaryBtn_cta=t.mvp?_:m,t.secondaryBtn_cta=t.mvp?m:o;var r="van"==t.vehicle_type?"vans/simple_teaser_"+n.vehicle.toUpperCase():"simple_teaser_"+n.vehicle;t.imageurl=`/content/dam/hq/personalization/simpleteaser/${r}.jpg/_jcr_content/renditions/cq5dam.web.1280.1280.jpeg`;break;case"phase2":t.primaryBtn_cta=_,t.secondaryBtn_cta=o;break;case"phase3":t.primaryBtn_cta=_,t.secondaryBtn_cta=p}if(e.overwrite_content&&e.vehicles_overwrite){const a=e.vehicles_overwrite.find((e=>e.baumuster===t.highest_affinity));if(a)switch(t.headline=a.headline||t.headline,n.trigger){case"phase1":case"phase2":t.secondaryBtn_cta=a.pi_page?a.pi_page:t.secondaryBtn_cta}}i({"vars.primaryBtn_cta":{exp:"string",val:typeof t.primaryBtn_cta},"vars.secondaryBtn_cta":{exp:"string",val:typeof t.secondaryBtn_cta},"vars.imageurl":{exp:"string",val:typeof t.imageurl},"vars.copy":{exp:"string",val:typeof t.copy},"vars.primaryBtn_label":{exp:"string",val:typeof t.primaryBtn_label},"vars.secondaryBtn_label":{exp:"string",val:typeof t.secondaryBtn_label},"vars.headline":{exp:"string",val:typeof t.headline}}),t.primaryBtn_cta&&t.secondaryBtn_cta&&t.copy&&t.primaryBtn_label&&t.secondaryBtn_label&&t.headline&&a.change_content(e,a,t,n,i,l,o)}},check_image:function(e,a=750){return new Promise(((t,n)=>{const i=new Image;let s=setTimeout((()=>{i.onload=null,i.onerror=null,t(!1)}),a);i.onload=()=>{clearTimeout(s),t(!0)},i.onerror=()=>{clearTimeout(s),t(!1)},i.src=e}))},change_content:async function(e,a,t,n,i,s,l){if(i([{simpleTeaserElement:{exp:!0,val:analytics_ow.personalisation.func.simpleteaser_update(!0,n.campaign)},campaignModuleElement:{exp:"object",val:typeof document.querySelector('[data-component-name="hp-campaigns"]:not([data-aem-targeting-hidden-initially])')}}]),n.trigger=t.mvp?"phase1-mvp":n.trigger,"target"===n.experience){let i=analytics_ow.personalisation.func.simpleteaser_update(!0,n.campaign);if(i){simpleteaser_data=analytics_ow.personalisation.func.getJSONData(i.getAttribute("component-id"))||"{}";var c="van"==t.vehicle_type?"vans/simple_teaser_"+n.vehicle.toUpperCase():"simple_teaser_"+n.vehicle;t.imageurl=`/content/dam/hq/personalization/simpleteaser/${c}.jpg/_jcr_content/renditions/cq5dam.web.1280.1280.jpeg`,newData=Object.assign({},simpleteaser_data,{headline:t.headline,copy:t.copy,image:{source:t.imageurl},links:[{url:t.secondaryBtn_cta,target:"_self",aria:null,label:t.secondaryBtn_label,type:"secondary"},{url:t.primaryBtn_cta,target:"_self",aria:null,label:t.primaryBtn_label,type:"primary"}]}),analytics_ow.personalisation.func.simpleteaser_update(!1,n.campaign,newData.headline,newData.copy,newData.image,newData.links,null,null),n.campaign="van"==t.vehicle_type?"vans_"+n.campaign:n.campaign,window.analytics_ow.personalisation.func.impressionTracking(n,e,"simpleTeaserElement_active"),window.analytics_ow.personalisation.func.sendEvergageData(e,n,"Impression"),setTimeout((function(){analytics_ow.personalisation.func.init_simple_teaser_buttons(e,n,i)}),500)}else if(document.querySelector('[data-component-name="hp-campaigns"]:not([data-aem-targeting-hidden-initially])')){n.format="campaign-module";const i=await a.check_image(`/content/dam/hq/personalization/campaignmodule/${"van"==t.vehicle_type?"vans/16x9/"+n.vehicle.toUpperCase()+"_16x9":"16x9/"+n.vehicle+"_16x9"}.jpg?im=Resize=(1,1)`);t.imageurl=i?`/content/dam/hq/personalization/campaignmodule/${"van"==t.vehicle_type?"vans/16x9/"+n.vehicle.toUpperCase()+"_16x9":"16x9/"+n.vehicle+"_16x9"}.jpg`:s.vehicles.find((e=>0===e.subBrands.length)).images.stage;const l={title:t.copy,subline:t.headline,image:t.imageurl,links:[{label:t.primaryBtn_label,link:t.primaryBtn_cta,target:"_self"},{label:t.secondaryBtn_label,link:t.secondaryBtn_cta,target:"_self"}],prio:4};n.campaign="van"==t.vehicle_type?"vans_"+n.campaign:n.campaign,analytics_ow.personalisation.func.campaign_module_update(l),analytics_ow.personalisation.func.campaign_module_tracking(l,n,e)}}else{let a="simpleTeaserElement_active";!analytics_ow.personalisation.func.simpleteaser_update(!0,n.campaign)&&document.querySelector('[data-component-name="hp-campaigns"]:not([data-aem-targeting-hidden-initially])')&&(n.format="campaign-module",a="campaignModuleElement_active"),n.campaign="van"==t.vehicle_type?"vans_"+n.campaign:n.campaign,window.analytics_ow.personalisation.func.impressionTracking(n,e,a),window.analytics_ow.personalisation.func.sendEvergageData(e,n,"Impression")}}},experience_specific_vars:{market:window.analytics_ow.personalisation.globalvars.market||window.analytics_ow.personalisation.func.find_all_by_key(dataLayer_ow,"market")[0],language:window.analytics_ow.personalisation.globalvars.language||window.analytics_ow.personalisation.func.find_all_by_key(dataLayer_ow,"language")[0].toLowerCase(),headline:null,copy:null,imageurl:null,image_bg:null,primaryBtn_label:null,primaryBtn_cta:null,secondaryBtn_label:null,secondaryBtn_cta:null,prio:4,vehicle_type:null,segments:null,mvp:!1},track_on_init:!1});