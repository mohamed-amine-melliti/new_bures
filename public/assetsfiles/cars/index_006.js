/*! globals 3.1.0 */
import{SeamlessConnection as e,initializeStore as t,InvalidConnectionNameError as n,ConnectionExistsError as s,PersistentConnection as r}from"@seamless/store";import{initializeLogger as o,SeamlessLogger as i}from"@seamless/logger";
/*! connection-aem-meta-tags 2.8.0 */var a,c;!function(e){e.NAME="name",e.PROPERTY="property"}(a||(a={})),function(e){e.META="meta",e.TITLE="title",e.HEAD="head"}(c||(c={}));const u={metaChangeRequests:{}},l="META_TAGS_UPDATE",d=new class extends e{logger;constructor(){super("MBMXP_OWC_META_TAGS_MANAGER"),this.logger=o("OWC FE LIBS META TAGS")}get initialState(){return u}hasRequestPermission(e){const t=window.seamlessRouter?window.seamlessRouter.mainNamespace:null;return t?e===t:(this.logger.warn("router component or the mainNamespace is not defined"),!1)}hasValidMetaAttribute(e){return e.metaValue===c.TITLE||!(!e.metaValue||!e.key)||(this.logger.error("Please provide a valid Meta tag change request"),!1)}metaTagsHandler(e){const t=document.querySelector(c.HEAD);t?e.forEach((e=>{if(!this.hasValidMetaAttribute(e.attribute))return;const n=e.attribute;if(n.metaValue===c.TITLE){const n=document.querySelector(c.TITLE);if(n)n.innerText=e.content;else{const n=document.createElement(c.TITLE);n.innerText=e.content,t.appendChild(n)}}else{const s=document.querySelector(`meta[${n.key}='${e.attribute.metaValue}']`);if(s)s.setAttribute("content",e.content);else{const s=document.createElement(c.META);s.setAttribute(n.key,e.attribute.metaValue),s.setAttribute("content",e.content),t.appendChild(s)}}})):this.logger.log("No head element present, skipping update")}stateHandler(e,t){const n=this.hasRequestPermission(t.payload.routerNamespace);return n&&this.metaTagsHandler(t.payload.metaTagsList),{metaChangeRequests:{...e.metaChangeRequests,[t.payload.routerNamespace]:{metaTags:t.payload.metaTagsList,allowedUpdate:n}}}}getReducer(){return(e=u,t)=>t.type===this.getActionType(l)?this.stateHandler(e,t):e}getPublicDispatchers(){return{updateMetaTags:(e,t)=>{const n=Array.isArray(e)?e:[e];return this.getAction(l,{metaTagsList:n,routerNamespace:t})}}}};
/*! vue-store-plugin 6.1.1 */
var w=function(){return w=Object.assign||function(e){for(var t,n=1,s=arguments.length;n<s;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},w.apply(this,arguments)},h=function(){function e(){}return Object.defineProperty(e.prototype,"mixin",{get:function(){return{data:function(){return{store:t()}}}},enumerable:!1,configurable:!0}),e.prototype.install=function(e){return e.mixin(w({},this.mixin))},e}();const f=e=>{const t=window.top.document.querySelector("iframe");if(t){const n=t.contentWindow.vueInstance,s=e.target,r=s.tagName.toLowerCase(),o=n.$options.components[r];if(o){const e=new o({propsData:{componentId:s.getAttribute("component-id"),dataEditMode:s.getAttribute("data-edit-mode")}});e.$mount();s.querySelectorAll(".cq-Editable-dom--container").forEach((t=>{e.$el.prepend(t)})),s.prepend(e.$el)}}};
/*! router 7.4.1 */
var p,m="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},g={},y=m&&m.t||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)},b=m&&m.i||function(e,t,n,s,r){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?r.call(e,n):r?r.value=n:t.set(e,n),n};Object.defineProperty(g,"o",{value:!0}),g.TokenData=void 0,g.parse=k,g.compile=function(e,t={}){const{encode:n=encodeURIComponent,delimiter:s=E}=t,r=A((e instanceof TokenData?e:k(e,t)).tokens,s,n);return function(e={}){const[t,...n]=r(e);if(n.length)throw new TypeError(`Missing parameters: ${n.join(", ")}`);return t}},g.match=function(e,t={}){const{decode:n=decodeURIComponent,delimiter:s=E}=t,{regexp:r,keys:o}=R(e,t),i=o.map((e=>!1===n?C:"param"===e.type?n:e=>e.split(s).map(n)));return function(e){const t=r.exec(e);if(!t)return!1;const n=t[0],s=Object.create(null);for(let e=1;e<t.length;e++){if(void 0===t[e])continue;const n=o[e-1],r=i[e-1];s[n.name]=r(t[e])}return{path:n,params:s}}},g.pathToRegexp=R,g.stringify=function(e){return e.tokens.map((function e(t,n,s){if("text"===t.type)return t.value.replace(/[{}()\[\]+?!:*]/g,"\\$&");if("group"===t.type)return`{${t.tokens.map(e).join("")}}`;const r=function(e){const[t,...n]=e;return!!$.test(t)&&n.every((e=>S.test(e)))}(t.name)&&function(e){return"text"!==e?.type||!S.test(e.value[0])}(s[n+1]),o=r?t.name:JSON.stringify(t.name);if("param"===t.type)return`:${o}`;if("wildcard"===t.type)return`*${o}`;throw new TypeError(`Unexpected token: ${t}`)})).join("")};const E="/",C=e=>e,$=/^[$_\p{ID_Start}]$/u,S=/^[$\u200c\u200d\p{ID_Continue}]$/u,O="https://git.new/pathToRegexpError",v={"{":"{","}":"}","(":"(",")":")","[":"[","]":"]","+":"+","?":"?","!":"!"};function T(e){return e.replace(/[.+*?^${}()[\]|/\\]/g,"\\$&")}class Iter{constructor(e){this.tokens=e,p.set(this,void 0)}peek(){if(!y(this,p,"f")){const e=this.tokens.next();b(this,p,e.value,"f")}return y(this,p,"f")}tryConsume(e){const t=this.peek();if(t.type===e)return b(this,p,void 0,"f"),t.value}consume(e){const t=this.tryConsume(e);if(void 0!==t)return t;const{type:n,index:s}=this.peek();throw new TypeError(`Unexpected ${n} at ${s}, expected ${e}: ${O}`)}text(){let e,t="";for(;e=this.tryConsume("CHAR")||this.tryConsume("ESCAPED");)t+=e;return t}}p=new WeakMap;class TokenData{constructor(e){this.tokens=e}}function k(e,t={}){const{encodePath:n=C}=t,s=new Iter(function*(e){const t=[...e];let n=0;function s(){let e="";if($.test(t[++n]))for(e+=t[n];S.test(t[++n]);)e+=t[n];else if('"'===t[n]){let s=n;for(;n<t.length;){if('"'===t[++n]){n++,s=0;break}e+="\\"===t[n]?t[++n]:t[n]}if(s)throw new TypeError(`Unterminated quote at ${s}: ${O}`)}if(!e)throw new TypeError(`Missing parameter name at ${n}: ${O}`);return e}for(;n<t.length;){const e=t[n],r=v[e];if(r)yield{type:r,index:n++,value:e};else if("\\"===e)yield{type:"ESCAPED",index:n++,value:t[n++]};else if(":"===e){const e=s();yield{type:"PARAM",index:n,value:e}}else if("*"===e){const e=s();yield{type:"WILDCARD",index:n,value:e}}else yield{type:"CHAR",index:n,value:t[n++]}}return{type:"END",index:n,value:""}}(e)),r=function e(t){const r=[];for(;;){const o=s.text();o&&r.push({type:"text",value:n(o)});const i=s.tryConsume("PARAM");if(i){r.push({type:"param",name:i});continue}const a=s.tryConsume("WILDCARD");if(a)r.push({type:"wildcard",name:a});else{if(!s.tryConsume("{"))return s.consume(t),r;r.push({type:"group",tokens:e("}")})}}}("END");return new TokenData(r)}function A(e,t,n){const s=e.map((e=>function(e,t,n){if("text"===e.type)return()=>[e.value];if("group"===e.type){const s=A(e.tokens,t,n);return e=>{const[t,...n]=s(e);return n.length?[""]:[t]}}const s=n||C;return"wildcard"===e.type&&!1!==n?n=>{const r=n[e.name];if(null==r)return["",e.name];if(!Array.isArray(r)||0===r.length)throw new TypeError(`Expected "${e.name}" to be a non-empty array`);return[r.map(((t,n)=>{if("string"!=typeof t)throw new TypeError(`Expected "${e.name}/${n}" to be a string`);return s(t)})).join(t)]}:t=>{const n=t[e.name];if(null==n)return["",e.name];if("string"!=typeof n)throw new TypeError(`Expected "${e.name}" to be a string`);return[s(n)]}}(e,t,n)));return e=>{const t=[""];for(const n of s){const[s,...r]=n(e);t[0]+=s,t.push(...r)}return t}}function R(e,t={}){const{delimiter:n=E,end:s=!0,sensitive:r=!1,trailing:o=!0}=t,i=[],a=[],c=r?"s":"is",u=(Array.isArray(e)?e:[e]).map((e=>e instanceof TokenData?e:k(e,t)));for(const{tokens:e}of u)for(const t of L(e,0,[])){const e=P(t,n,i);a.push(e)}let l=`^(?:${a.join("|")})`;return o&&(l+=`(?:${T(n)}$)?`),l+=s?"$":`(?=${T(n)}|$)`,{regexp:new RegExp(l,c),keys:i}}function*L(e,t,n){if(t===e.length)return yield n;const s=e[t];if("group"===s.type){const r=n.slice();for(const n of L(s.tokens,0,r))yield*L(e,t+1,n)}else n.push(s);yield*L(e,t+1,n)}function P(e,t,n){let s="",r="",o=!0;for(let i=0;i<e.length;i++){const a=e[i];if("text"!==a.type)if("param"!==a.type&&"wildcard"!==a.type);else{if(!o&&!r)throw new TypeError(`Missing text after "${a.name}": ${O}`);"param"===a.type?s+=`(${M(t,o?"":r)}+)`:s+="(.+)",n.push(a),r="",o=!1}else s+=T(a.value),r=a.value,o||(o=a.value.includes(t))}return s}function M(e,t){const n=[e,t].filter(Boolean);return n.every((e=>1===e.length))?`[^${T(n.join(""))}]`:`(?:(?!${n.map(T).join("|")}).)`}g.TokenData=TokenData;const _=".html",D=["Path"];function j(e,t){const n=e.pathname.lastIndexOf(t);return n>=0?`${e.pathname.substring(0,n+t.length)}/`:"/"}function U(e,t){if(null==e&&null==t)return!0;if(null==e||null==t)return!1;const n=Object.keys(e),s=Object.keys(t);return n.length===s.length&&n.every((n=>e[n]===t[n]))}const x=e=>{try{return decodeURIComponent(e)}catch(t){return e}};function N(e,t,n){const s={};for(const[r,o]of e){const e=x(o);t&&!t(r,e)||(s[n?n(r):r]=e)}return s}const I=o("SeamlessRouter");function W(){V()}function V(e=!1){const t=z(),n=t.currentUrl,s=new URL(String(window.location));t.currentUrl=s;const r=new Map;t.urlChangeListeners.forEach((t=>{const o=function(e,t,n,s){const r=s.get(e.namespace||null);if(null!=r)return r;if(null==e.namespace){const e={hasChanged:t.href!==n.href,event:{from:{url:t,subPathname:B(t)},to:{url:n,subPathname:B(n)}}};return s.set(null,e),e}const o=G(t,e.namespace),i=G(n,e.namespace),a={hasChanged:o.subPathname!=i.subPathname||!U(o.searchParams,i.searchParams),event:{from:o,to:i}};return s.set(e.namespace,a),a}(t,n,s,r);(o.hasChanged||e)&&t.handler(o.event)}))}function G(e,t){const n=z(),s=B(e,t),r=function(e,t,n){if(null==t)return N(e.searchParams);const s=e=>e.substr(t.length);if(t===n)return N(e.searchParams,(e=>e.startsWith(t)),s);const r=`${t}Path`;return N(e.searchParams,(e=>e.startsWith(t)&&e!=r),s)}(e,t,n.mainNamespace);return{url:e,subPathname:s,searchParams:r}}function B(e,t){const n=z();if(null==t||t===n.mainNamespace)return e.pathname.substring(n.basePathname.length-1)||"/";const s=`${t}Path`;return e.searchParams.get(s)||"/"}function H(){var e;(null===(e=window.seamlessRouter)||void 0===e?void 0:e.isInitialized)||function(){var e;if(null===(e=window.seamlessRouter)||void 0===e?void 0:e.isInitialized)return;const t=z();t.currentUrl=new URL(String(window.location)),t.basePathname=j(t.currentUrl,_),t.isInitialized=!0,window.addEventListener("popstate",W),window.addEventListener("hashchange",W)}()}function q(e){if("string"!=typeof e)throw new TypeError("[routing] namespace must be a string literal");H();const t=z();if(null!=t.mainNamespace)return void(null!=e&&t.mainNamespace!==e&&I.warn("[sw-routing] refused re-set of main namespace. It can only be set once."));t.mainNamespace=e;const n=`${e}Path`,s=t.currentUrl.searchParams.get(n);if(null!=s&&s.length>0){const r=function(e){if(H(),!function(e){if(null==e||"object"!=typeof e)return I.warn("[sw-routing] resolve arguments should contain an URLInitOption object or array or an URLGlobalOptions object"),!1;if(Array.isArray(e)){if(0===e.length)return I.warn("[sw-routing] Namespace options argument must contain at least one URLInitOption object"),!1;if(!e.every((e=>K(e))))return I.warn('[sw-routing] Namespace options must be an object with a "namespace" string property.'),!1}else if(!K(e))return I.warn('[sw-routing] Namespace options must contain a "namespace" string property.'),!1;return!0}(e))return null;const{target:t,isSamePage:n}=function(){const e=z();return{target:new URL(String(e.currentUrl)),isSamePage:!0}}();return Array.isArray(e)?e.forEach((e=>{F(t,e,n)})):e&&F(t,e,n),t}({namespace:e,path:s,hash:t.currentUrl.hash});null!=r&&(r.searchParams.delete(n),function(e,t=!1,n=!0){H();const s=z(),r=e.href===s.currentUrl.href;!function(e,t,n,s){s?(window.top||window).location.href=e.href:(t?window.history.replaceState({from:"url"},"",e.href):window.history.pushState({from:"url"},"",e.href),n&&V())}(e,t,n&&!r,!function(e){H();const t=z();if("string"==typeof e){if(e.length>0){const n=e.endsWith("/")?e:e+"/";return t.basePathname===n}return!0}if(e instanceof URL){const n=j(e,_);return t.basePathname===n}return!1}(e))}(r,!0,!0))}else V(!0);I.log(`[sw-routing] accepted main namespace ${t.mainNamespace}`)}function z(){const e=window.top||window;if(e.seamlessRouter)return e.seamlessRouter;const t=new URL(String(e.location));return e.seamlessRouter={mainNamespace:null,basePathname:j(t,_),urlChangeListeners:[],currentUrl:t,isInitialized:!1},e.seamlessRouter}function K(e){return"string"==typeof e.namespace}function F(e,t,n){const s=z(),r=t.searchParams,o=t.pathname||t.path;if(o){const r=o.startsWith("/")?o:`/${o}`;if(t.namespace===s.mainNamespace&&n){let t=s.basePathname;s.basePathname.endsWith("/")&&(t=s.basePathname.substring(0,s.basePathname.length-1)),e.pathname=`${t}${r}`}else e.searchParams.set(`${t.namespace}Path`,r)}t.hash&&(e.hash=t.hash),r&&Object.entries(r).forEach((([n,s])=>{if(D.includes(n))return void I.warn(`[sw-routing] Using '${n}' as a search param is not allowed and will be ignored.`);const r=`${t.namespace}${n}`;null==s?e.searchParams.delete(r):e.searchParams.set(r,s)}))}const J=["namespace","path","pathname","hash","search-params"];class RouterViewQuery extends HTMLElement{static get observedAttributes(){return J}constructor(){super(),this.queryOptions={namespace:"",path:"",hash:"",searchParams:{}},this.queryKey=Symbol();const e=document.createElement("style");e.textContent=RouterViewQuery.stylesheet,this.attachShadow({mode:"closed"}).append(e)}attributeChangedCallback(e,t,n){switch(e){case"path":case"pathname":this.queryOptions.path=n;break;case"hash":this.queryOptions.hash=n;break;case"search-params":{const e=n.split("&").map((e=>e.split("="))),t=Object.fromEntries(e);this.queryOptions.searchParams=t;break}case"namespace":this.queryOptions.namespace=n}this.dispatchEvent(new CustomEvent("sw-query-update",{bubbles:!0,detail:{queryOptions:this.queryOptions,key:this.queryKey}}))}}RouterViewQuery.stylesheet="\n    :host {\n      display: none !important;\n    }\n  ","function"==typeof SuppressedError&&SuppressedError;const Q=["namespace","path","pathname","hash","search-params"];class RouterLinkTarget extends HTMLElement{static get observedAttributes(){return Q}constructor(){super(),this.urlParts={namespace:"",path:"",hash:"",searchParams:{}},this.targetKey=Symbol();const e=document.createElement("style");e.textContent=RouterLinkTarget.stylesheet,this.attachShadow({mode:"closed"}).append(e)}attributeChangedCallback(e,t,n){switch(e){case"path":case"pathname":this.urlParts.path=n;break;case"hash":this.urlParts.hash=n;break;case"search-params":{const e=n.split("&").map((e=>e.split("="))),t=Object.fromEntries(e);this.urlParts.searchParams=t;break}case"namespace":this.urlParts.namespace=n}this.dispatchEvent(new CustomEvent("sw-target-update",{bubbles:!0,detail:{urlParts:this.urlParts,key:this.targetKey}}))}}RouterLinkTarget.stylesheet="\n    :host {\n      display: none !important;\n    }\n  ";const X=window.top||window,Y="OWC_AEM_ENV",Z=new class extends e{constructor(){super(Y)}get initialState(){const e=window.aemNamespace?.environmentVariables||window.top?.aemNamespace?.environmentVariables,t=window.aemNamespace?.pageEnvironmentVariables||window.top?.aemNamespace?.pageEnvironmentVariables;return e&&t?{...e,...t}:{}}getReducer(){return()=>this.initialState}getPublicDispatchers(){return{}}},ee=async()=>{const e=t();return await(async()=>{if(!window.top?.aemNamespace&&!window.aemNamespace)return new Promise((e=>{let t;Object.defineProperty(window.top,"aemNamespace",{get:()=>t,async set(n){t=n,e()}})}))})(),await(async()=>{if(!window.top?.aemNamespace?.environmentVariables&&!window?.aemNamespace?.environmentVariables)return new Promise((e=>{let t;Object.defineProperty(window.top?.aemNamespace,"environmentVariables",{get:()=>t,set(n){t=n,e()}})}))})(),await(async()=>{if(!window.top?.aemNamespace?.pageEnvironmentVariables&&!window?.aemNamespace?.pageEnvironmentVariables)return new Promise((e=>{let t;Object.defineProperty(window.top?.aemNamespace,"pageEnvironmentVariables",{get:()=>t,set(n){t=n,e()}})}))})(),e.addConnection(Z)
/*! connection-wko-manager 3.1.0 */},te={ConsentList:[],User:null},ne="OWC_WKO",se="UPDATE_WKO",re=new class extends e{constructor(){super(ne)}get initialState(){return te}getReducer(){return(e=te,t)=>t.type===this.getActionType(se)?{...e,[t.payload.name]:t.payload.value}:e}getPublicDispatchers(){return{setWko:e=>this.getAction(se,e)}}},oe=async()=>t().addConnection(re),ie=async()=>{const e=t();return await e.getConnectionDispatchers(ne)},ae="ow_aem",ce={authentication:{jwe:`${ae}_jwe`,jwt:`${ae}_jwt`,token:`${ae}_sub`,roles:`${ae}_roles`},user:{personal:{name:`${ae}_name`,firstname:`${ae}_firstname`,lastname:`${ae}_lastname`,gender:`${ae}_gender`,email:`${ae}_email`,phone:`${ae}_phone`,roles:`${ae}_roles`,wkoUserData:`${ae}_wkoUserData`},associatedVehicles:`${ae}_userAssociatedVehicles`,associatedDealers:`${ae}_userAssociatedDealers`,selectedAssociatedVehicle:`${ae}_selectedAssociatedVehicle`,consent:{dataUsageScopes:`${ae}_dataUsageScopes`,enableDataUsages:`${ae}_enableDataUsages`}}};var ue;!function(e){e.local="local",e.session="session"}(ue||(ue={}));class BrowserStorageUtils{t;loggingEnabled=!1;logger=o("OWC FE LIBS");constructor(e){t().subscribe(Y,(e=>{"prod"!==e.stageVariant&&(this.loggingEnabled=!0)})),this.t=e}get storage(){return this.t===ue.local?window.localStorage:window.sessionStorage}async getItem(e){const t=this.storage.getItem(e);if(this.loggingEnabled&&this.logger.log(`${this.t} : getItem : key: ${e}`),null==t)return this.loggingEnabled&&this.logger.warn(`${this.storage} : could not find key: ${e}`),null;try{return JSON.parse(t)}catch{return this.loggingEnabled&&this.logger.warn(`${this.storage} : could not convert "${e}" to JSON, returning it as is`),t}}}const le="User",de="ConsentList";var we,he;!function(e){e.SALES="SALES",e.SERVICE="SERVICE"}(we||(we={}));class LoginChecks{sessionStorage=new BrowserStorageUtils("session");wkoManagerDispatchers;user={};authentication={};constructor(){this.init()}async init(){this.wkoManagerDispatchers=await ie(),this.initializeLoginchecks()}async getStoredValues(e){const t=Object.keys(e),n=Object.values(e),s=t.reduce((async(e,t,s)=>{const r=await e,o=await this.sessionStorage.getItem(n[s]);return null==o?r:{...r,[t]:o}}),Promise.resolve({}));return await s}async getAuthentication(){return await this.getStoredValues(ce.authentication)}async getUserPersonalData(){return await this.getStoredValues(ce.user.personal)}async getUserConsent(){return await this.getStoredValues(ce.user.consent)}async getSelectedAssociatedVehicle(){return await this.sessionStorage.getItem(ce.user.selectedAssociatedVehicle)}async getUserAssociatedVehicles(){return await this.sessionStorage.getItem(ce.user.associatedVehicles)}async getUserAssociatedDealers(){return await this.sessionStorage.getItem(ce.user.associatedDealers)}getUserSelectedAssociatedDealer(e){const t=e.selectedAssociatedVehicle?.finOrVin;if(e.selectedAssociatedVehicle&&e.userAssociatedDealers&&t){const n=e.userAssociatedDealers[t];if(n)return n.reduce(((e,t)=>(t.dealerType===we.SALES?e.salesDealer=t:t.dealerType===we.SERVICE&&(e.serviceDealer=t),e)),{})}return{}}async getLoginchecksObject(){const e=await Promise.all([this.getAuthentication(),this.getUserPersonalData(),this.getUserAssociatedVehicles(),this.getSelectedAssociatedVehicle(),this.getUserAssociatedDealers(),this.getUserConsent()]);return{authentication:e[0],userPersonalData:e[1],associatedVehicles:e[2],selectedAssociatedVehicle:e[3],userAssociatedDealers:e[4],userConsent:e[5]}}updateStore(e,t){this.wkoManagerDispatchers.setWko({name:e,value:t})}async generateLoginchecksWkos(){const e=await this.getLoginchecksObject(),t=this.getUserSelectedAssociatedDealer(e);this.user={personal:e.userPersonalData,associatedVehicles:e.associatedVehicles,selectedAssociatedVehicle:e.selectedAssociatedVehicle,selectedAssociatedDealer:t,associatedDealers:e.userAssociatedDealers,consent:e.userConsent},this.authentication=e.authentication}async initializeLoginchecks(){this.generateLoginchecksWkos().then((()=>{this.updateStore(le,this.user),this.addWkoManagerListener()}))}addWkoManagerListener(){window.addEventListener("wko-manager-update",(async()=>{await this.generateLoginchecksWkos(),this.updateStore(le,this.user)}))}}!function(e){e.ucEvents="ucEvents",e.ucEventsUpdated="usercentrics-consents-updated",e.ucConsentsLoaded="usercentrics-consents-loaded"}(he||(he={}));class ConsentList{wkoManagerConnection;constructor(){this.init(),this.addEventListeners()}async init(){this.wkoManagerConnection=await ie()}addEventListeners(){window.addEventListener(he.ucEventsUpdated,this.consentListener),document.addEventListener(he.ucConsentsLoaded,this.consentListener,!1)}consentListener=e=>{e.detail?.consents&&this.wkoManagerConnection.setWko({name:de,value:e.detail.consents})}}class WKOManager{store=t();allWkos;loginChecks;consentList;constructor(){this.initializeWkoManager()}async initializeWkoManager(){this.store.subscribe(ne,(e=>{this.allWkos=e})),this.loginChecks=new LoginChecks,this.consentList=new ConsentList}}
/*! connection-aem-translations 2.8.0 */
const fe="PUSH_TRANSLATION_MESSAGE",pe={},me=new class extends e{constructor(){super("MBMXP_OWC_TRANSLATION_MANAGER")}get initialState(){return pe}getReducer(){return(e,t)=>t.type===this.getActionType(fe)?e[t.payload.projectID]?{...e,[t.payload.projectID]:{...e[t.payload.projectID],...t.payload.translation}}:{...e,[t.payload.projectID]:t.payload.translation}:e}getPublicDispatchers(){return{pushTranslationMessage:(e,t)=>this.getAction(fe,{projectID:e,translation:t})}}},ge=async()=>t().addConnection(me)
/*! connection-aem-tracking 2.7.0 */,ye="OWC_TRACKING_MANAGER",be="PUSH_TRACKING_EVENT",Ee={trackingEvents:[]},Ce=new class extends e{constructor(){super(ye)}get initialState(){return Ee}getReducer(){return(e=Ee,t)=>t.type===this.getActionType(be)?{...e,trackingEvents:[...e.trackingEvents,t.payload]}:e}getPublicDispatchers(){return{pushTrackingEvent:e=>(window.top?.dataLayer_ow.push(e),this.getAction(be,e))}}},$e=`OWC FE LIBS ${ye}`,Se=async()=>{const e=t();return await(()=>{if(!window.top?.dataLayer_ow)return o($e).warn("window.dataLayer_ow is not defined, adding empty Object"),new Promise((e=>{let t;Object.defineProperty(window.top,"dataLayer_ow",{get:()=>t,set(n){t=n,e()}})}))})(),e.addConnection(Ce)
/*! component-registry-connection 2.8.0 */},Oe={components:{}},ve="OWC_COMPONENT_REGISTRY",Te="ADD_COMPONENT",ke="REMOVE_COMPONENT",Ae="ADD_COMPONENTS",Re=new class extends e{constructor(){super(ve)}get initialState(){return Oe}getReducer(){return(e=Oe,t)=>{switch(t.type){case this.getActionType(Te):return e.components[t.payload.id]=t.payload.data,{...e,components:{...e.components,[t.payload.id]:t.payload.data}};case this.getActionType(Ae):return{...e,components:{...e.components,...t.payload}};case this.getActionType(ke):return delete e.components[t.payload],{...e,components:{...e.components}};default:return e}}}getPublicDispatchers(){return{addComponents:e=>this.getAction(Ae,e),addComponent:e=>this.getAction(Te,e),removeComponent:e=>this.getAction(ke,e)}}},Le=async()=>{const e=t();return await e.getConnectionDispatchers(ve)},Pe=(e,t)=>{if(e===t)return!0;if("object"!=typeof e||"object"!=typeof t)return!1;const n=Object.keys(e);return n.length===Object.keys(t).length&&n.every((n=>Pe(e[n],t[n])))};class OwcComponentRegistry{store=t();logger=o("OWC FE LIBS COMPONENT REGISTRY");previousState={};compareStateReference={};componentListeners=new Map;constructor(){this.store.subscribe(ve,(e=>{!Object.keys(this.previousState).length&&Object.keys(e.components).length&&(this.compareStateReference=e.components);for(const[t,n]of this.componentListeners){const s=e.components[t];this.hasComponentStateChanged(t,s)&&n.forEach((e=>e(s)))}this.previousState=e.components})),this.initConnection()}async initConnection(){await(async()=>{const e=t();return await e.addConnection(Re)})(),await ee();const e=await Le(),n=window.top||window;n.aemNamespace||(this.logger.warn("window.top?.aemNamespace is not defined, adding an empty Object"),n.aemNamespace={}),n.aemNamespace?.componentData&&e.addComponents(n.aemNamespace.componentData),this.store.subscribe(Y,(async t=>{if("AUTHOR"===t.runMode){const{proxy:t}=await import("./author-BlRZJm_w-DxxMIvCY.js");t(n.aemNamespace.componentData??{},e)}}))}subscribe(e,t){this.getComponentDataListeners(e).push(t),this.previousState&&e in this.previousState&&t(this.previousState[e])}unsubscribe(e,t){const n=this.getComponentDataListeners(e),s=n.indexOf(t);s>=0&&n.splice(s,1)}getComponentDataListeners(e){let t=this.componentListeners.get(e);return null==t&&(t=[],this.componentListeners.set(e,t)),t}hasComponentStateChanged(e,t){const n=!Pe(t,this.compareStateReference[e]);return(e&&t&&n||!this.compareStateReference[e])&&(this.compareStateReference[e]=t),n}async addComponents(e){(await Le()).addComponents(e)}async addComponent(e){(await Le()).addComponent(e)}async removeComponent(e){(await Le()).removeComponent(e)}}const Me=["AemEnvironment","WkoManager","TranslationManager","Tracking"],_e=["ComponentRegistry","WkoManager"],De=["SeamlessStore","SeamlessLogger"],je=async e=>{const t=e?.loggerInstance,n=e?.connections?e.connections:Me;for await(const e of n)switch(e){case"AemEnvironment":await ee(),t?.log("added AemEnvironmentConnection");break;case"WkoManager":await oe(),t?.log("added ConnectionWkoManager");break;case"TranslationManager":ge().then((()=>{t?.log("added TranslationConnection")}));break;case"Tracking":Se().then((()=>{t?.log("added TrackingReducerConnection")}))}},Ue=e=>{const t=e?.loggerInstance;(e?.packages?e.packages:_e).forEach((async e=>{switch(e){case"ComponentRegistry":!function(){const e=window.top||window;null==e.owc&&(e.owc={componentRegistry:new OwcComponentRegistry}),null==e.owc.componentRegistry&&(e.owc.componentRegistry=new OwcComponentRegistry),e.owc.componentRegistry}(),t?.log("initialized component registry");break;case"WkoManager":!function(){const e=window.top||window;let t=e.owc?.wkoManager;if(null==t&&e.aemNamespace){const n=new WKOManager;e.owc?e.owc.wkoManager=n:e.owc={wkoManager:n},t=e.owc.wkoManager}}(),t?.log("initialized wko manager")}}))},xe=a=>{const c={};let u=["SeamlessStore"];return!a?.namespace&&a?.starters?u=a?.starters.filter((e=>"SeamlessLogger"!==e)):a?.namespace&&(u=a?.starters?a?.starters:De),u.forEach((u=>{switch(u){case"SeamlessStore":c.store=((o="prod")=>{const i=()=>!!X?.seamlessStore,a=t(o);return X.seamlessStore||(X.seamlessStore={store:a,initializeStore:t,isStoreAvailable:i,SeamlessConnection:e,PersistentConnection:r,ConnectionExistsError:s,InvalidConnectionNameError:n}),Object.seal(X.seamlessStore),Object.seal(X.seamlessStore.store),X.seamlessStore.store})("prod");break;case"SeamlessLogger":c.logger=a?(e=>{const t=o(e);return X.seamlessLogger||(X.seamlessLogger={seamlessLoggerInstance:new i,initializeLogger:o}),t})(a.namespace):void 0}})),c},Ne="3.1.0",{logger:Ie}=xe({namespace:"OWC FE LIBS GLOBALS"});(()=>{if(window.Vue&&window.addEventListener("DOMContentLoaded",(function(){const e=new window.Vue;document.querySelectorAll('[data-integration-type="vuecomponent"]:not([data-vue-version^="3"])').forEach((e=>{new window.Vue({el:e})})),window.vueInstance=e})),"AUTHOR"===window.top?.aemNamespace.pageEnvironmentVariables.runMode){const e=window.top.document.querySelector("iframe");e&&e.contentWindow.document.addEventListener("component-updated",f)}})(),(async e=>{const t=Object.keys(window.aemNamespace.componentData);for(const n of t){const t=window.aemNamespace.componentData[n];if(t.config?.routingEnabled)return e.log(`Setting main namespace for router: ${t.config.routerNamespace}`),void q(t.config.routerNamespace)}})(Ie).then((()=>{(async()=>t().addConnection(d))().then((()=>Ie.log(`GLOBALS 3.1.0 ${"added ConnectionMetaTagsManager"}`)))})),je({loggerInstance:Ie}).then((()=>(async()=>window.Vue?(window.Vue.use(h),!1):new Error("Vue seems not defined on window"))().catch((e=>Promise.resolve(e))))).then((e=>{e&&Ie.error(e),Ue({loggerInstance:Ie})})).catch((e=>Ie.error(e)));export{je as addStoreConnections,Ue as initializePackages,xe as setupEnvironment,Ne as version};
//# sourceMappingURL=index.js.map
